## cobweb

仅使用 mysql 数据库作为基础， sequelize 作为 orm 的基于 koa 的轻量级框架

且支持深入的 restful 接口生成器，及基于 openapi 的文档生成器，及基于 jsonschema 的接口参数校验器

typescript 版本

## 计划

1. 使用 koa 做基础框架
    使用 koa 中间件增强 web 功能。
2. 所有引用第三方服务的库，比如：mysql，redis，mongodb，mq 等，全部封装成 service 放在 lib 下，归类为引用的第三方服务。
3. 所有不需要引用第三方服务的，均归类为工具函数（包含异步库），封装在 lib/common 下
4. 函数与类采用 ts 强类型约束，减少错误。且接口处均采用 validate 函数校验传入参数。校验规则采用 jsonschema 格式统一编写。
5. 文档采用 openapi 格式输出。此处需要研究 openapi 文档，做到自动收集接口
6. 测试需要覆盖全部接口，工具函数均需要完成单元测试。业务逻辑酌情测试
7. 异常处理业务逻辑层采用自定义异常，异常分类两大类，错误和异常。错误指代自身程序问题。异常指代调用者或其它第三方问题。分为逻辑错误（自身的），传入参数异常（调用者的），第三方服务返回的数据异常（第三方的）
8. 异常在 koa 中间件统一处理成 http 异常形式返回给调用者。
9. 迁移脚本使用 seeder 进行数据初始化工作。模型的改动使用 sequelize-migration 迁移方案
10. 程序内静态变量均使用 lib/config 文件夹下可配置的 json 格式。且如需暴露的 环境变量 均在 config 中进行声明。程序内不可直接依赖环境变量
11. 需支持 docker，pm2 等部署
12. 代码采用 eslint 语法检查， 使用 ts 编写
13. 持续集成支持
14. 服务端渲染使用 handlerbars 模板语言
15. 需支持可开启的 webscoket 接口，webscoket 与 web 可支持内部互通
16. 文件上传与下载，断点续传能力。
17. 接口安全（访问频次，用户权限）
## 插件

所有第三方服务均可采用 plugin 的形式安装在系统内容，系统需要提供开关来控制是否启用某个插件。如短信服务，邮件服务等

1. 短信服务
2. 邮件服务
3. mongodb
4. elasticsearch
5. mq
6. couchdb

## 中间件

中间件系统使用 koa 中间件规范，旨在增强 koa 能力，处理 web 事物。

1. 统一的数据返回格式
2. 统一的异常处理
3. 统一授权
4. 统一的权限验证

## 模型

模型采用 sequelize 的模型系统。

## 路由/api 接口/restful

路由分为页面路由和 api 接口，以及 restful 生成器生成的 restful 风格路由。

1. 页面
    服务端渲染的页面，以及 文档，测试报告等
2. restful 接口
    restful 风格接口形式，已名词定义（复数？），描述的是一个资源
3. api 接口
    传统 service 形式 api 接口，接口命名由 动词组成，描述的是一个业务动作

